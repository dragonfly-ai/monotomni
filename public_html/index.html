<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mono+Omni Demo</title>
<script type="application/javascript">
var HOST_NAME = "Mono+Omni Demo";
</script>
<style>
a {color: #DDDDDD;}
</style>
</head>
<body style="background-color: #444444; color: #DDDDDD; font-family: Helvetica, sans-serif;">
<div style="width:500px; float:right;">
<a href="http://localhost:8080/demo/index.html">Test Mono+Omni with AJAX</a><br />
<a href="http://127.0.0.1:8080/demo/index.html">Test Mono+Omni over JSONP</a>
</div>
<h1>Mono+Omni Demo</h1><br />
<div style="width:48%; float:left;">
Scala.JS Application Output:<br />
<pre id="app" style="background-color: #222222; color: #EEFF44; padding:16px; width: 100%; height: 50%; max-height: 600px; overflow-y: scroll; overflow: scroll;"></pre>
</div>
<div style="width:48%; float:right;">
JavaScript Library Output:<br />
<pre id="lib" style="background-color: #222222; color: #44FF44; padding:16px; width: 80%; height: 50%; max-height: 600px; overflow-y: scroll; overflow: scroll;"></pre>
<script type="application/javascript">
var print = console.log

// write console output to div
console.log = (function(){
  var app = document.getElementById("app");
  return function(s) {
    app.innerHTML = app.innerHTML + "<br />" + s;
    print(s);
  }
})();
</script>
<script type="application/javascript" src="./js/monotomni-opt.js"></script>
<script type="application/javascript">
/* Demo JavaScript library features: */

var jsLib = (function(){
  var lib = document.getElementById("lib");
  return {
    "log" : function(s){
      lib.innerHTML = lib.innerHTML + "<br />" + s;
      print(s);
    }
  }
})();

jsLib.log('Mono+Omni.toString() => ' + (Omni.toString()));
var now = Mono+Omni.now();
jsLib.log('var now = Mono+Omni.now(); => ' + now);
var tt = monotomni.TimeTrial(now);
jsLib.log('var tt = monotomni.TimeTrial(now); => ' + tt);
var str = monotomni.TimeTrial.BINARY(monotomni.TimeTrial.XML(tt.XML).BINARY).STRING;
jsLib.log('var str = monotomni.TimeTrial.BINARY(monotomni.TimeTrial.XML(tt.XML).BINARY).STRING;' + str);
jsLib.log('try { throw monotomni.InvalidTimeTrialJSON("neenerneenerneener") } catch (e) {console.log(e.toString())}');
try { throw monotomni.InvalidTimeTrialJSON("neenerneenerneener") } catch (e) {jsLib.log(e.toString())}
jsLib.log('var ajaxXMLConnection = monotomni.connection.http.AJAX(new URL("http://localhost:8080/time"), monotomni.TimeTrial.Formats.XML, 1000);');
var ajaxXMLConnection = monotomni.connection.http.AJAX(new URL("http://localhost:8080/time"), monotomni.TimeTrial.Formats.XML, 1000);
jsLib.log('var remoteClock = monotomni.RemoteClock(ajaxXMLConnection);');
var remoteClock = monotomni.RemoteClock(ajaxXMLConnection);
jsLib.log(remoteClock.toString());

var localMOI = [];
var remoteAMI = [];

function repeatedIdGeneration(){
  var moi = Mono+Omni();

  var ami = remoteClock.ami();
  jsLib.log('remoteAMI[' + remoteAMI.length + '] = ' + ami);
  remoteAMI.push(ami);
  setTimeout(repeatedIdGeneration, Math.random() * 5000);
}

remoteClock.ready(function(){
  repeatedIdGeneration();
});

</script>
</body>
</html>